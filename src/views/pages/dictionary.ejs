<% layout("layouts/boilerplate") %>

<!-- src/views/pages/dictionary.ejs -->
<link rel="stylesheet" href="/css/dictionary.css">

<section class="legal-dictionary" id="legal-dictionary-root" data-user="<%= user ? 'true' : 'false' %>">
  <div class="legal-dictionary__container">

    <!-- Header -->
    <header class="legal-dictionary__header" role="banner" aria-labelledby="ld-title">
      <div class="hero__inner">
        <h1 id="ld-title" class="legal-dictionary__title">
          Legal<span class="legal-dictionary__accent">HuB</span> Dictionary
        </h1>
        <p class="legal-dictionary__subtitle">Professional legal definitions, simplified.</p>
      </div>

      <!-- Global Save (top-right) -->
      <div class="legal-dictionary__header-actions" aria-hidden="false">
        <button id="ld-save-global" class="card__action-btn--save" aria-label="Save current term (login required)" <%= user ? "" : "disabled" %>>
          <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path fill="currentColor" d="M6 2h10a1 1 0 0 1 1 1v18l-6-3-6 3V3a1 1 0 0 1 1-1z"/>
          </svg>
          <span class="ld-save-label">Save</span>
        </button>
      </div>
    </header>

    <!-- Search card -->
    <div class="ld-search-card" role="region" aria-label="Search legal terms">
      <form id="ld-search-form" class="legal-dictionary__search" role="search" aria-label="Search form" action="/dictionary/search" method="post">
        <div class="ld-search__input-wrap">
          <input id="ld-term-input"
                 class="ld-search__input"
                 name="term"
                 type="search"
                 placeholder="e.g., Habeas Corpus, Estoppel"
                 aria-label="Search term"
                 autocomplete="off"
                 required />
          <span id="ld-search-spinner" class="ld-search__spinner" aria-hidden="true"></span>
        </div>

        <button id="ld-search-btn" class="ld-btn ld-btn--primary" type="submit" aria-label="Search">
          Search
        </button>
      </form>

      <p class="legal-dictionary__tip">ðŸ’¡ Tip: Be specific for the best results (add jurisdiction like "â€” India").</p>

      <!-- Recent searches -->
      <div id="ld-recent" class="ld-recent" aria-live="polite" aria-atomic="true"></div>
    </div>

    <!-- Meta + Source badge (hidden until result) -->
    <div id="ld-meta" class="ld-meta hidden" aria-hidden="true" style="margin-top:10px;">
      <span id="ld-source-badge" class="card__badge card__badge--source" aria-hidden="true"></span>
    </div>

    <!-- Skeleton loader (hidden by default) -->
    <div id="ld-skeleton" class="hidden" aria-hidden="true" style="margin-top:20px;">
      <div class="ld-card" role="status" aria-live="polite" aria-busy="true">
        <div class="skeleton" style="height:24px;width:45%;margin-bottom:12px;border-radius:8px"></div>
        <div class="skeleton" style="height:12px;width:100%;margin-bottom:8px;border-radius:6px"></div>
        <div class="skeleton" style="height:12px;width:92%;margin-bottom:8px;border-radius:6px"></div>
        <div class="skeleton" style="height:12px;width:60%;margin-top:12px;border-radius:6px"></div>
      </div>
    </div>

    <!-- Results container -->
    <main id="ld-result" class="legal-dictionary__result" aria-live="polite" aria-busy="false" style="margin-top:26px;">
      <!-- Initial welcome state -->
      <div class="ld-card" id="ld-welcome" role="status" aria-live="polite">
        <div class="card__header">
          <div>
            <h2 class="card__term-title">Welcome to LegalHuB</h2>
            <div class="card__badge-list" aria-hidden="true">
              <span class="card__badge">Definitions</span>
              <span class="card__badge">Examples</span>
              <span class="card__badge">Guides</span>
            </div>
          </div>
        </div>

        <div class="card__section card__section--definition">
          <h3 class="card__section-title">Get started</h3>
          <div class="card__section-body">
            <p class="muted-note">
              Search for a legal term to get started. Use clear phrases like <em>Divorce â€” India</em> or <em>Habeas Corpus</em>.
              Results will appear below as structured cards (Definition, Key Aspects, Examples, Steps).
            </p>
          </div>
        </div>
      </div>
    </main>

    <!-- Related terms aside -->
    <aside id="ld-related" class="ld-related hidden" aria-label="Related terms" style="margin-top:18px;">
      <h3 class="card__section-title" style="margin:0 0 8px 0;">Related terms</h3>
      <div id="ld-related-list" class="card__related" role="list"></div>
    </aside>

  </div>
</section>

<noscript>
  <div style="max-width:900px;margin:18px auto;padding:12px;background:#fff3bf;border-left:4px solid #f59e0b;border-radius:8px;color:#111;">
    <strong>JavaScript required:</strong> This page needs JavaScript enabled to search and display AI-generated definitions. The search form will fallback to server POST when JavaScript is disabled.
  </div>
</noscript>

<!-- Main script (deferred) -->
<script src="/js/dictionary.js" defer></script>
